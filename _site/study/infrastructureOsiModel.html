<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>OSI Model ¬∑ glucolte</title>
  <meta name="description" content="notes ‚Ä¢ principles ‚Ä¢ systems">
  <link rel="stylesheet" href="/assets/style.css">
  <link rel="stylesheet" href="/assets/study.css">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/favicon.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>OSI Model | glucolte</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="OSI Model" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="notes ‚Ä¢ principles ‚Ä¢ systems" />
<meta property="og:description" content="notes ‚Ä¢ principles ‚Ä¢ systems" />
<link rel="canonical" href="http://localhost:4000/study/infrastructureOsiModel" />
<meta property="og:url" content="http://localhost:4000/study/infrastructureOsiModel" />
<meta property="og:site_name" content="glucolte" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="OSI Model" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"notes ‚Ä¢ principles ‚Ä¢ systems","headline":"OSI Model","url":"http://localhost:4000/study/infrastructureOsiModel"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>
  <header class="site-header">
  <a class="brand" href="/">glucolte</a>
  <nav class="nav">
    <a href="/principles">principles</a>
    <a href="/rules">rules</a>
    <a href="/stretches">stretches</a>
    <a href="/study/">study</a>
    <a href="/projects/">projects</a>
    <a href="/setup/">setup</a>
  </nav>
  <button id="dark-mode-toggle" class="dark-mode-toggle" aria-label="Toggle dark mode">
    <svg class="sun-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
    <svg class="moon-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </button>
</header>


  <main class="container">
    <article class="content">
      <h1 id="osi-model">OSI Model</h1>

<p>The <strong>OSI (Open Systems Interconnection) Model</strong> is a conceptual framework that describes how data moves across a network. It breaks communication into <strong>seven layers</strong>, each with a distinct role‚Äîfrom physical signals up to human-facing applications.</p>

<p>By separating responsibilities, the OSI model makes it easier to design, troubleshoot, and scale networks. Each higher layer builds on the services of the one below, while remaining logically independent.</p>

<hr />

<h2 id="section-1-the-7-layers">1. The 7 Layers</h2>

<table class="study-table">
<thead>
<tr>
<th>Layer</th>
<th>Example Protocols</th>
<th>Data Unit</th>
<th>What It Adds / Handles</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>L7 Application</td>
<td>HTTP, DNS, SMTP, FTP</td>
<td>Data</td>
<td>User-facing services</td>
<td>Browser ‚Üí HTTP, Mail ‚Üí SMTP.</td>
</tr>
<tr>
<td>L6 Presentation</td>
<td>TLS/SSL, JPEG, JSON</td>
<td>Record</td>
<td>Data format, encryption, compression</td>
<td>Often merged into L7.</td>
</tr>
<tr>
<td>L5 Session</td>
<td>NetBIOS, RPC</td>
<td>‚Äì</td>
<td>Session setup &amp; teardown</td>
<td>Rarely explicit today.</td>
</tr>
<tr>
<td>L4 Transport</td>
<td>TCP, UDP</td>
<td>Segment</td>
<td>Reliable (TCP) vs fast (UDP)</td>
<td>TCP = handshake, ports, seq/ack. UDP = stateless.</td>
</tr>
<tr>
<td>L3 Network</td>
<td>IP, ICMP</td>
<td>Packet</td>
<td>Logical addressing &amp; routing</td>
<td>Routers forward packets. Uses ARP for MAC resolution.</td>
</tr>
<tr>
<td>L2 Data Link</td>
<td>Ethernet, Wi-Fi, PPP</td>
<td>Frame</td>
<td>Local delivery</td>
<td>Frames = MAC headers + payload + CRC.</td>
</tr>
<tr>
<td>L1 Physical</td>
<td>Copper, Fiber, Wi-Fi PHY</td>
<td>Bits</td>
<td>Transmission of raw signals</td>
<td>Voltage, RF, or optical light.</td>
</tr>
</tbody>
</table>

<p>üîÅ <strong>Encapsulation order:</strong><br />
<code class="language-plaintext highlighter-rouge">Application Data ‚Üí Segment ‚Üí Packet ‚Üí Frame ‚Üí Bits</code></p>

<div class="image-wrapper">
  <img src="https://assets.bytebytego.com/diagrams/0295-osi-model.jpeg" alt="ByteByteGo OSI Model" class="modal-trigger" data-caption="OSI Model Layers explained with protocols and data flow" />
  <div class="image-caption">
    <a href="https://bytebytego.com/guides/what-is-osi-model/" target="_blank" style="text-decoration: none; color: var(--accent);">
      üìñ Source: OSI Model Explained ‚Äì Byte Byte Go
    </a>
  </div>
</div>

<hr />

<h2 id="section-2-devices-at-each-layer">2. Devices at Each Layer</h2>

<table class="study-table">
<thead>
<tr>
<th>Device</th>
<th>Layer</th>
<th>What It Does</th>
<th>Protocols</th>
<th>Authentication</th>
</tr>
</thead>
<tbody>
<tr>
<td>Load Balancer</td>
<td>L4‚ÄìL7</td>
<td>Distributes traffic</td>
<td>TCP, HTTP/S, gRPC</td>
<td>TLS certs, tokens</td>
</tr>
<tr>
<td>Firewall</td>
<td>L3‚ÄìL4 (sometimes L7)</td>
<td>Filters packets/flows</td>
<td>IP, TCP/UDP, HTTP</td>
<td>Rules, TLS interception, VPN</td>
</tr>
<tr>
<td>Router</td>
<td>L3</td>
<td>Routes IP packets</td>
<td>IP, ICMP, BGP, OSPF</td>
<td>BGP MD5, IPsec</td>
</tr>
<tr>
<td>Switch</td>
<td>L2</td>
<td>Forwards frames by MAC</td>
<td>Ethernet, VLAN, ARP</td>
<td>802.1X, MAC binding</td>
</tr>
<tr>
<td>Hub</td>
<td>L1</td>
<td>Repeats bits blindly</td>
<td>‚Äì</td>
<td>None</td>
</tr>
</tbody>
</table>

<hr />

<h2 id="section-3-layer-interactions">3. Layer Interactions</h2>

<h3 id="section-3-1-layer-2-arp">3.1 Layer 2 ‚Äì ARP</h3>

<p>Maps IP ‚Üí MAC via broadcast request and unicast reply.</p>

<div class="image-wrapper">
  <img src="./assets/l2_arp.png" alt="L2 ARP Example" class="modal-trigger" data-caption="ARP (Address Resolution Protocol) sequence diagram showing IP to MAC address resolution" />
  <div class="diagram-caption" data-snippet-id="arp-snippet">
    üñºÔ∏è ARP ‚Äì Address Resolution Protocol Sequence
  </div>
    <!-- Keep your PlantUML raw here -->
  <script type="text/plain" id="arp-snippet">
@startuml
actor "Host A\n(133.33.3.7)" as A
participant "Switch / LAN" as LAN
actor "Host B\n(133.33.3.10)" as B

== Step 1: Need to Send ==
A -> A: Wants to send packet to B (IP 133.33.3.10)
note right of A: Needs B's MAC address

== Step 2: ARP Request ==
A -> LAN: Broadcast ARP Request\n"Who has 133.33.3.10? Tell 133.33.3.7"
note over LAN: Sent to FF:FF:FF:FF:FF:FF (all hosts)

== Step 3: ARP Reply ==
B -> LAN: ARP Reply\n"I am 133.33.3.10, my MAC = 3e:22:fb:b9:5b:78"
LAN -> A: Deliver ARP Reply

== Step 4: Frame Delivery ==
A -> B: Frame (Src MAC A ‚Üí Dst MAC B)\nCarrying IP Packet (A IP ‚Üí B IP)
note over A,B: Now Host A can send data directly to Host B
@enduml
  </script>
</div>

<hr />

<h3 id="section-3-2-layer-2-vlans-trunks">3.2 Layer 2 ‚Äì VLANs &amp; Trunks</h3>
<p>VLANs, trunks, and QinQ are needed to segment traffic, reduce broadcast domains, and efficiently carry multiple logical networks over the same physical infrastructure.</p>

<ul>
  <li><strong>VLAN (802.1Q):</strong>
    <ul>
      <li>Adds a VLAN ID tag inside Ethernet frames.</li>
      <li>Splits one physical switch into <strong>multiple broadcast domains</strong> ‚Üí improves scalability &amp; security.</li>
    </ul>
  </li>
  <li><strong>Trunks:</strong>
    <ul>
      <li>A single link between switches that <strong>carries multiple VLANs</strong> using tagging.</li>
      <li>Avoids needing one cable per VLAN.</li>
    </ul>
  </li>
  <li><strong>QinQ (802.1AD):</strong>
    <ul>
      <li><strong>VLAN stacking</strong> (two tags: S-Tag + C-Tag).</li>
      <li>Lets ISPs carry customer VLANs over their own backbone.</li>
      <li>Expands VLAN ID space beyond the 4096 limit.</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="section-3-3-layer-3-routing">3.3 Layer 3 ‚Äì Routing</h3>
<p>Routers strip old frames, keep IP header, attach new MAC header for next hop.</p>

<div class="image-wrapper">
  <img src="./assets/l3_routing.png" alt="L3 Routing Example" class="modal-trigger" data-caption="L3 Routing sequence diagram showing packet routing through different networks" />
  <div class="diagram-caption" data-snippet-id="routing-snippet">
    üñºÔ∏è L3 Routing ‚Äì Packet Routing Sequence
  </div>
  <!-- Keep your PlantUML raw here -->
  <script type="text/plain" id="routing-snippet">
@startuml
actor Host as H
participant "Router 1\n(Home Gateway)" as R1
participant "Router 2\n(Transit)" as R2
actor "Destination Host" as D

== Step 1: Local Network ==
H -> R1: Frame(H-MAC ‚Üí R1-MAC) carrying Packet(H-IP ‚Üí D-IP)
note right of H: ARP used to resolve R1 MAC

== Step 2: First Routing Hop ==
R1 -> R2: Frame(R1-MAC ‚Üí R2-MAC) carrying Packet(H-IP ‚Üí D-IP)
note over R1: Removes old frame (H-MAC ‚Üí R1-MAC)\nAdds new frame (R1-MAC ‚Üí R2-MAC)

== Step 3: Second Routing Hop ==
R2 -> D: Frame(R2-MAC ‚Üí D-MAC) carrying Packet(H-IP ‚Üí D-IP)
note over R2: Removes old frame (R1-MAC ‚Üí R2-MAC)\nAdds new frame (R2-MAC ‚Üí D-MAC)\nUses ARP to resolve D MAC

== Step 4: Delivery ==
D <-- R2: Destination Host receives Packet(H-IP ‚Üí D-IP)
note right of D: Frame removed, IP packet delivered up the stack
@enduml
  </script>
</div>

<hr />

<h3 id="section-3-4-layer-3-56---ipsec">3.4 Layer 3 &amp; 5‚Äì6 - IPsec</h3>
<p>IPsec = encrypted <strong>network tunnels</strong>.</p>
<ul>
  <li><strong>IKE (control plane)</strong> negotiates SAs and keys (<strong>Layer 5‚Äì6</strong>, over UDP/500 or UDP/4500 for NAT-T).</li>
  <li><strong>ESP/AH (data plane)</strong> protects IP packets at <strong>Layer 3</strong>.</li>
  <li>Commonly used for site-to-site and remote-access VPNs.</li>
  <li>Protects <em>all traffic</em> (HTTP, SSH, DNS, ICMP, etc.), independent of app protocol.</li>
</ul>

<div class="image-wrapper">
  <img src="./assets/ipsec_handshake.png" alt="IPsec Example" class="modal-trigger" data-caption="IPsec handshake sequence showing IKE phase 1 and 2 negotiations" />
  <div class="diagram-caption" data-snippet-id="ipsec-snippet">
    üñºÔ∏è IPsec ‚Äì IKE Handshake Sequence
  </div>
  <!-- Keep your PlantUML raw here -->
  <script type="text/plain" id="ipsec-snippet">
@startuml
actor Client
actor Server

== IKE Phase 1 (Main Mode / IKE_SA_INIT + IKE_AUTH) ==
Client -> Server: IKE_SA_INIT (DH/ECDH group, nonces, proposals) over UDP/500 (or 4500 NAT-T)
Server -> Client: IKE_SA_INIT Response
note over Client,Server: Exchange DH/ECDH (ephemeral by design) -> derive IKE SA key (PFS)

Client -> Server: IKE_AUTH (ID, Certificate/PSK, Auth payload)
Server -> Client: IKE_AUTH Response
note over Client,Server: Peers authenticated; secure IKE control channel established

== IKE Phase 2 (Quick Mode / CHILD_SA) ==
Client -> Server: CHILD_SA proposal (ESP/AH algos, lifetimes, selectors)
Server -> Client: CHILD_SA response
note over Client,Server: Negotiate keys/SPI for ESP/AH; set rekey lifetimes

== Encrypted Tunnel Established ==
note over Client,Server: All subsequent IP traffic protected inside ESP/AH (per CHILD_SA)

== Payload ==
alt Tunnel mode
  Client -> Server: ESP { Outer IP | ESP hdr(SPI, Seq) | Inner IP | TCP/UDP | App Data }
  Server -> Client: ESP { Outer IP | ESP hdr(SPI, Seq) | Inner IP | TCP/UDP | App Data }
else Transport mode
  Client -> Server: ESP { IP | ESP hdr(SPI, Seq) | TCP/UDP | App Data }
  Server -> Client: ESP { IP | ESP hdr(SPI, Seq) | TCP/UDP | App Data }
end

== Operations ==
... Rekey on lifetime expiry; DPD/keepalives monitor liveness ...
@enduml
  </script>
</div>
<blockquote>
  <p>Elliptic Curve Diffie‚ÄìHellman Ephemeral provides <strong>Perfect Forward Secrecy (PFS)</strong> by using a fresh, temporary key pair per session. Even if a server‚Äôs long-term private key is later compromised, past sessions remain confidential. Both TLS and IPsec commonly prefer ECDHE for key exchange.</p>
</blockquote>

<hr />

<h3 id="section-3-5-layer-56---tls">3.5 Layer 5‚Äì6 - TLS</h3>
<p>TLS = encrypted <strong>application sessions</strong>.</p>
<ul>
  <li>Runs above TCP (L4) and below Application (L7).</li>
  <li>Provides confidentiality, integrity, authentication.</li>
  <li>Examples: HTTPS, SMTPS, IMAPS.</li>
  <li>Protects <em>specific app protocols</em>, not all traffic.</li>
</ul>

<div class="image-wrapper">
  <img src="./assets/tls_handshake.png" alt="TLS Example" class="modal-trigger" data-caption="TLS handshake sequence showing client hello, server hello, certificate exchange, and key creation" />
  <div class="diagram-caption" data-snippet-id="tls-snippet">
    üñºÔ∏è TLS ‚Äì Secure Handshake Sequence
  </div>
  <!-- Keep your PlantUML raw here -->
  <script type="text/plain" id="tls-snippet">
@startuml
actor Client
actor Server
actor CA

== TCP Setup ==
Client -> Server: SYN / SYN-ACK / ACK
note over Client,Server: TCP connection established

== TLS Handshake ==
Client -> Server: ClientHello (ciphers, random)
Server -> Client: ServerHello + Certificate
Client -> CA: Validate cert chain (CA root, expiry, hostname)

Client -> Server: ECDHE public value
Server -> Client: ECDHE public value
note over Client,Server: Derive shared secret (Perfect Forward Secrecy)

Client -> Server: Finished
Server -> Client: Finished
note over Client,Server: Secure TLS channel established

== Payload ==
Client -> Server: TLS record { Application Data: HTTP Request }
Server -> Client: TLS record { Application Data: HTTP Response }
@enduml
  </script>
</div>

<hr />

<h3 id="section-3-6-traffic-addressing-modes-unicast-broadcast-multicast-anycast-geocast">3.6 Traffic Addressing Modes (Unicast, Broadcast, Multicast, Anycast, Geocast)</h3>

<p>How frames/packets are addressed determines who receives them and how the network treats them.</p>

<table class="study-table">
<thead>
<tr>
  <th>Mode</th>
  <th>Who Receives</th>
  <th>OSI Context</th>
  <th>Typical Uses</th>
  <th>Key Notes</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Unicast</strong></td>
  <td>Exactly one host</td>
  <td>L2 (MAC‚ÜíMAC), L3 (IP‚ÜíIP)</td>
  <td>Web browsing, API calls, SSH</td>
  <td>Most traffic is unicast. Switched at L2, routed at L3.</td>
</tr>
<tr>
  <td><strong>Broadcast</strong></td>
  <td>All hosts in the L2 broadcast domain</td>
  <td>L2 (FF:FF:FF:FF:FF:FF)</td>
  <td>ARP, DHCP DISCOVER</td>
  <td>Routers block broadcasts by default.</td>
</tr>
<tr>
  <td><strong>Multicast</strong></td>
  <td>Members of a subscribed group</td>
  <td>L3 (224.0.0.0/4 IPv4; ff00::/8 IPv6)</td>
  <td>IPTV, conferencing, OSPF</td>
  <td>Uses IGMP/MLD (hosts), PIM (routers).</td>
</tr>
<tr>
  <td><strong>Anycast</strong></td>
  <td>‚ÄúNearest‚Äù one of many identical endpoints</td>
  <td>L3 (same IP announced in multiple sites)</td>
  <td>CDNs, DNS resolvers</td>
  <td>Routing selects the closest service.</td>
</tr>
<tr>
  <td><strong>Geocast</strong></td>
  <td>Hosts in a geographic region</td>
  <td>L3 concept</td>
  <td>Vehicular alerts, ITS</td>
  <td>Conceptual; app-layer in practice.</td>
</tr>
</tbody>
</table>

<hr />

<h2 id="section-4-commands-by-osi-layer">4. Commands by OSI Layer</h2>

<table class="study-table">
<thead>
<tr>
<th>Layer</th>
<th>Command</th>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>L2</td>
<td><code>arp</code></td>
<td>Show ARP cache</td>
<td><code>arp -a</code></td>
</tr>
<tr>
<td>L3</td>
<td><code>ping</code></td>
<td>Test ICMP reachability</td>
<td><code>ping 8.8.8.8</code></td>
</tr>
<tr>
<td>L3</td>
<td><code>traceroute</code></td>
<td>Show hop path</td>
<td><code>mtr 8.8.8.8</code></td>
</tr>
<tr>
<td>L4</td>
<td><code>ss</code></td>
<td>List sockets</td>
<td><code>ss -ant</code></td>
</tr>
<tr>
<td>L4</td>
<td><code>tcpdump</code></td>
<td>Capture packets</td>
<td><code>tcpdump -i eth0 port 443</code></td>
</tr>
<tr>
<td>L7</td>
<td><code>dig</code></td>
<td>DNS lookup</td>
<td><code>dig example.com</code></td>
</tr>
<tr>
<td>L7</td>
<td><code>curl</code></td>
<td>Test HTTP</td>
<td><code>curl -vk https://site</code></td>
</tr>
<tr>
<td>Cross</td>
<td><code>nmap</code></td>
<td>Port scan</td>
<td><code>nmap -sS 10.1.2.3</code></td>
</tr>
</tbody>
</table>

<hr />

<h2 id="section-5-ip-addressing-basics">5. IP Addressing Basics</h2>

<h3 id="section-5-1-ipv4-classes-reservations">5.1 IPv4 Classes &amp; Reservations</h3>
<ul>
  <li><strong>Class A:</strong> 0.0.0.0 ‚Äì 127.255.255.255 (10.0.0.0/8 private, 127/8 loopback)</li>
  <li><strong>Class B:</strong> 128.0.0.0 ‚Äì 191.255.255.255 (172.16.0.0/12 private)</li>
  <li><strong>Class C:</strong> 192.0.0.0 ‚Äì 223.255.255.255 (192.168/16 private, TEST-NETs)</li>
  <li><strong>Class D:</strong> 224.0.0.0 ‚Äì 239.255.255.255 (multicast)</li>
  <li><strong>Class E:</strong> 240.0.0.0 ‚Äì 255.255.255.255 (experimental)</li>
</ul>

<hr />

<h3 id="section-5-2-convert-binary-to-decimal">5.2 Convert Binary to Decimal</h3>

<ol>
  <li>Take the binary <code class="language-plaintext highlighter-rouge">10000100</code>.</li>
  <li>
    <p>Multiply each bit by its place value:</p>

    <ul>
      <li>1√ó128 + 0√ó64 + 0√ó32 + 0√ó16 + 0√ó8 + 1√ó4 + 0√ó2 + 0√ó1</li>
    </ul>
  </li>
  <li>Add them up ‚Üí <strong>132</strong>.</li>
</ol>

<table class="study-table">
<thead>
<tr>
<th style="text-align: center;">Position</th>
<th style="text-align: center;">1</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">6</th>
<th style="text-align: center;">7</th>
<th style="text-align: center;">8</th>
<th style="text-align: center;">Sum</th>
</tr>
</thead>
<tbody>
<tr>
<td>Decimal</td>
<td style="text-align: center;">128</td>
<td style="text-align: center;">64</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Bit</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Value</td>
<td style="text-align: center;">128</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center; font-weight: bold;">132</td>
</tr>
</tbody>
</table>

<p>üëâ So <code class="language-plaintext highlighter-rouge">10000100</code> in decimal = <strong>132</strong></p>

<hr />

<h3 id="section-5-3-convert-decimal-to-to-binary">5.3 Convert Decimal to to Binary</h3>

<p>Take the first octet of <code class="language-plaintext highlighter-rouge">132.12.1.23</code>.</p>

<ol>
  <li>Start from <strong>128</strong> ‚Üí 132 ‚â• 128 ‚Üí put <strong>1</strong>, remainder = 132 ‚àí 128 = 4.</li>
  <li>Next (64) ‚Üí 4 &lt; 64 ‚Üí <strong>0</strong>.</li>
  <li>Next (32) ‚Üí 4 &lt; 32 ‚Üí <strong>0</strong>.</li>
  <li>Next (16) ‚Üí 4 &lt; 16 ‚Üí <strong>0</strong>.</li>
  <li>Next (8) ‚Üí 4 &lt; 8 ‚Üí <strong>0</strong>.</li>
  <li>Next (4) ‚Üí 4 ‚â• 4 ‚Üí <strong>1</strong>, remainder = 0.</li>
  <li>Next (2) ‚Üí 0 &lt; 2 ‚Üí <strong>0</strong>.</li>
  <li>Next (1) ‚Üí 0 &lt; 1 ‚Üí <strong>0</strong>.</li>
</ol>

<p>Result row: <strong>1 0 0 0 0 1 0 0</strong></p>

<table class="study-table">
<thead>
<tr>
<th style="text-align: center;">Position</th>
<th style="text-align: center;">1</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">6</th>
<th style="text-align: center;">7</th>
<th style="text-align: center;">8</th>
</tr>
</thead>
<tbody>
<tr>
<td>Decimal</td>
<td style="text-align: center;">128</td>
<td style="text-align: center;">64</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td>Representation</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>

<p>üëâ So <code class="language-plaintext highlighter-rouge">132</code> in binary = <strong>10000100</strong></p>

<hr />

<h2 id="section-6-advanced-networking-topics">6. Advanced Networking Topics</h2>

<h3 id="section-6-1-nat-network-address-translation">6.1 NAT (Network Address Translation)</h3>

<ul>
  <li>Allows private IPs (RFC1918) to communicate with public networks.</li>
  <li>Originally designed to conserve IPv4 addresses, also adds a basic security layer by hiding internal hosts.</li>
  <li><strong>Types:</strong>
    <ul>
      <li><strong>Static NAT</strong> ‚Üí Fixed 1:1 mapping (one private ‚Üî one public). Useful for servers that must be reachable externally.</li>
      <li><strong>Dynamic NAT</strong> ‚Üí Private IPs mapped temporarily to an available public IP from a pool. Mapping changes each session.</li>
      <li><strong>PAT (Port Address Translation)</strong> ‚Üí Many private hosts share a single public IP. NAT device rewrites source <strong>IP+Port</strong> to track flows. Example: home routers, carrier-grade NAT appliances.</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="section-6-2-ddos-attacks-3-categories">6.2 DDoS Attacks (3 categories)</h3>

<ol>
  <li><strong>Volumetric</strong> ‚Üí Flood bandwidth with massive traffic (e.g., UDP floods, DNS/NTP amplification).</li>
  <li><strong>Protocol</strong> ‚Üí Exploit L3/L4 weaknesses, exhausting connection state (e.g., SYN flood, Smurf attack, Ping of Death).</li>
  <li><strong>Application</strong> ‚Üí Target app layer (L7) with valid-looking requests that overwhelm servers (e.g., HTTP floods, Slowloris).</li>
</ol>

<hr />

<h3 id="section-6-3-bgp-border-gateway-protocol">6.3 BGP (Border Gateway Protocol)</h3>

<p>The internet is a <strong>network of networks</strong> (Autonomous Systems, or AS):</p>

<ul>
  <li><strong>AS (Autonomous System):</strong> Collection of IP prefixes under one admin domain.</li>
  <li><strong>ASN (Autonomous System Number):</strong> Unique ID (Google = AS15169, Amazon = AS16509).</li>
  <li><strong>BGP Basics:</strong> Protocol to exchange routing info between ASes (runs over TCP/179).</li>
  <li><strong>iBGP</strong> ‚Üí Routing <strong>inside</strong> an AS (e.g., Google‚Äôs internal backbone).</li>
  <li><strong>eBGP</strong> ‚Üí Routing <strong>between</strong> ASes (e.g., ISP ‚Üî Cloudflare).</li>
  <li><strong>ASPATH:</strong> List of AS hops; shortest usually preferred.</li>
  <li><strong>Policies &amp; Tricks:</strong>
    <ul>
      <li><strong>ASPATH prepending</strong> ‚Üí make a path look less attractive.</li>
      <li><strong>Route filtering</strong> ‚Üí accept/export only selected prefixes.</li>
      <li><strong>Peering vs Transit</strong> ‚Üí prefer cheap/free peer routes over costly transit.</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="section-6-4-jumbo-frames">6.4 Jumbo Frames</h3>

<ul>
  <li><strong>Default MTU = 1500 bytes</strong>, Jumbo Frames = ~9000 bytes.</li>
  <li><strong>Benefits:</strong> Less overhead, fewer packets, higher throughput for large data transfers.</li>
  <li><strong>Limitations:</strong> Must be supported end-to-end; mismatches cause fragmentation or drops.</li>
  <li><strong>Supported in:</strong> Local networks, datacenter interconnects, dedicated private backbones, and direct cloud interconnect links.</li>
  <li><strong>Not supported in:</strong> General internet, VPN over public internet, cross-region cloud traffic.</li>
</ul>

<hr />

<h3 id="section-6-5-layer-7-firewalls">6.5 Layer 7 Firewalls</h3>

<ul>
  <li>Extend firewalls beyond L3/L4 (IP, port) to <strong>application-aware filtering at L7</strong>.</li>
  <li>Parse and inspect protocols (HTTP, DNS, SMTP, gRPC).</li>
  <li><strong>Capabilities:</strong>
    <ul>
      <li>Block/allow traffic based on <strong>URLs, headers, payloads</strong>.</li>
      <li>Detect and stop <strong>application-layer DDoS</strong> (HTTP floods, bots).</li>
      <li>Enforce <strong>auth/security policies</strong> (tokens, TLS inspection).</li>
    </ul>
  </li>
  <li><strong>Examples:</strong> Cloudflare WAF, Palo Alto NGFW, F5 ASM, Imperva SecureSphere.</li>
</ul>

<hr />

<h2 id="domain-name-system-dns">7. Domain Name System (DNS)</h2>

<h3 id="section-7-1-what-dns-does">7.1 What DNS Does</h3>

<p><strong>DNS (Domain Name System)</strong> maps human-readable names (e.g., <code class="language-plaintext highlighter-rouge">example.com</code>) to IP addresses or other service endpoints. Two roles often get conflated:</p>
<ul>
  <li><strong>DNS hosting provider</strong> ‚Üí Runs the authoritative name servers that store and answer your zone‚Äôs records (A, MX, TXT, etc.).</li>
  <li><strong>Domain registrar / registry</strong> ‚Üí Manages ownership of domain names within a top-level domain (<code class="language-plaintext highlighter-rouge">.com</code>, <code class="language-plaintext highlighter-rouge">.org</code>, etc.) and publishes NS/DS records that delegate authority to your DNS host.</li>
</ul>

<p>Some companies handle both functions (e.g., GoDaddy, Cloudflare), while others let you register in one place and host DNS somewhere else.</p>

<hr />

<h3 id="section-7-2-common-dns-record-types">7.2 Common DNS Record Types</h3>

<table class="study-table">
<thead>
<tr>
<th>Record Type</th>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>A</strong></td>
<td>Maps domain ‚Üí IPv4 address</td>
<td><code>example.com. IN A 192.0.2.1</code></td>
</tr>
<tr>
<td><strong>AAAA</strong></td>
<td>Maps domain ‚Üí IPv6 address</td>
<td><code>example.com. IN AAAA 2001:db8::1</code></td>
</tr>
<tr>
<td><strong>CNAME</strong></td>
<td>Alias to another domain (not IP)</td>
<td><code>www.example.com. IN CNAME example.globalcdn.com.</code></td>
</tr>
<tr>
<td><strong>ANAME / Alias</strong></td>
<td>Provider-specific pseudo-record that behaves like a CNAME at the apex (e.g., Route 53 Alias, NS1 ANAME).</td>
<td><code>example.com. IN ALIAS edge.globalcdn.net</code></td>
</tr>
<tr>
<td><strong>MX</strong></td>
<td>Mail routing</td>
<td><code>example.com. IN MX 10 mail1.google.com.</code></td>
</tr>
<tr>
<td><strong>TXT</strong></td>
<td>Metadata (SPF, DKIM, domain verification)</td>
<td><code>example.com. IN TXT "v=spf1 include:_spf.google.com ~all"</code></td>
</tr>
<tr>
<td><strong>NS</strong></td>
<td>Authoritative name servers for a zone</td>
<td><code>example.com. IN NS ns1.dnsprovider.com.</code></td>
</tr>
<tr>
<td><strong>SOA</strong></td>
<td>Zone info (serial, refresh, retry)</td>
<td><code>example.com. IN SOA ns1 hostmaster 2025010101 3600 1800 1209600 86400</code></td>
</tr>
<tr>
<td><strong>PTR</strong></td>
<td>Reverse DNS (IP ‚Üí domain)</td>
<td><code>1.2.0.192.in-addr.arpa. IN PTR example.com.</code></td>
</tr>
<tr>
<td><strong>CAA</strong></td>
<td>Restricts which Certificate Authorities can issue TLS certs</td>
<td><code>example.com. IN CAA 0 issue "letsencrypt.org"</code></td>
</tr>
<tr>
<td><strong>SRV</strong></td>
<td>Service-specific record (SIP, LDAP, Kerberos)</td>
<td><code>_sip._tcp.example.com. IN SRV 10 60 5060 sipserver.example.com.</code></td>
</tr>
</tbody>
</table>

<hr />

<h3 id="section-7-3-apex-naked-domains">7.3 Apex (Naked) Domains</h3>

<ul>
  <li>The <strong>zone apex</strong> (e.g., <code class="language-plaintext highlighter-rouge">example.com</code>) represents the root of your domain.</li>
  <li>DNS standards forbid placing a CNAME at the apex because it would conflict with other mandatory records (NS, SOA).</li>
  <li>Many providers offer <strong>ANAME/Alias</strong> features to simulate a CNAME at the apex by resolving the target to an A/AAAA record on the server side (e.g., Route 53 Alias, Cloudflare CNAME flattening).</li>
  <li>For subdomains like <code class="language-plaintext highlighter-rouge">www.example.com</code>, you can safely use CNAME, ANAME/Alias, or A/AAAA records depending on the use case.</li>
</ul>

<hr />

<h3 id="section-7-4-dns-resolution-flow">7.4 DNS Resolution Flow</h3>

<ol>
  <li>A user queries <code class="language-plaintext highlighter-rouge">example.com</code> via a <strong>recursive resolver</strong> (ISP, Google Public DNS, Cloudflare, etc.).</li>
  <li>If the answer is uncached, the resolver asks the <strong>root servers</strong> which TLD (<code class="language-plaintext highlighter-rouge">.com</code>) server is authoritative.</li>
  <li>The resolver queries the <strong>TLD servers</strong>, which respond with the authoritative <strong>NS records</strong> for <code class="language-plaintext highlighter-rouge">example.com</code>.</li>
  <li>The resolver contacts the authoritative name servers for <code class="language-plaintext highlighter-rouge">example.com</code> (your DNS host) and retrieves the requested record (A, MX, TXT, ‚Ä¶).</li>
  <li>The resolver caches the response based on its TTL and returns the answer to the user‚Äôs application, which then reaches out to the resolved endpoint.</li>
</ol>

<hr />

<h3 id="section-7-5-dnssec-overview">7.5 DNSSEC Overview</h3>

<p><strong>DNSSEC (Domain Name System Security Extensions)</strong> protects against forged DNS data by cryptographically signing DNS responses. It ensures <strong>authenticity</strong> and <strong>integrity</strong>, but it does <strong>not</strong> encrypt traffic.</p>

<blockquote>
  <p>Without DNSSEC, attackers can poison resolver caches or spoof responses. With DNSSEC, resolvers reject tampered data because signatures fail validation.</p>
</blockquote>

<h4 id="section-7-5-1-key-concepts">7.5.1 Key Concepts</h4>

<ul>
  <li><strong>Digital Signatures</strong>: Authoritative servers sign each RRset with a private key; resolvers validate using the corresponding public key.</li>
  <li><strong>DNSSEC Records</strong>:
    <ul>
      <li><strong>DNSKEY</strong> ‚Üí Publishes the public keys for the zone.</li>
      <li><strong>DS (Delegation Signer)</strong> ‚Üí Parent zone pointer to the child zone‚Äôs key, extending the trust chain.</li>
      <li><strong>RRSIG</strong> ‚Üí Signature attached to each signed record set.</li>
    </ul>
  </li>
  <li><strong>Chain of Trust</strong>: Root (trust anchor) ‚Üí TLD ‚Üí Authoritative zone. Every delegation must be signed to keep the chain intact.</li>
</ul>

<h4 id="section-7-5-2-roles-and-responsibilities">7.5.2 Roles and Responsibilities</h4>

<ul>
  <li><strong>Root &amp; TLD Operators</strong>: Maintain signed parent zones and publish DS records for child delegations.</li>
  <li><strong>Zone Owners / DNS Hosts</strong>: Generate keys, sign zones, and supply DS records to the registrar.</li>
  <li><strong>Recursive Resolvers</strong>: Validate signatures and refuse bogus data. Many public resolvers already validate DNSSEC by default.</li>
  <li><strong>End Users</strong>: No action required; they benefit from resolvers rejecting tampered responses.</li>
</ul>

<h4 id="section-7-5-3-dnssec-validation-flow">7.5.3 Validation Flow</h4>

<ol>
  <li>Resolver requests the <strong>DS record</strong> for <code class="language-plaintext highlighter-rouge">example.com</code> from the TLD; verifies the response using the TLD‚Äôs signature.</li>
  <li>Resolver requests the <strong>DNSKEY</strong> record set from <code class="language-plaintext highlighter-rouge">example.com</code>‚Äôs authoritative servers and verifies it against the DS digest.</li>
  <li>Resolver fetches the desired record (e.g., <code class="language-plaintext highlighter-rouge">A example.com</code>) along with its <strong>RRSIG</strong>.</li>
  <li>Using the validated DNSKEY, the resolver checks the RRSIG. If it validates, the answer is accepted and cached; otherwise the response is discarded as suspicious.</li>
</ol>

<div class="image-wrapper">
  <img src="./assets/dnssec_resolution_flow.png" alt="DNSSEC Resolution Flow" class="modal-trigger" data-caption="DNSSEC resolution flow with chain of trust" />
  <div class="diagram-caption" data-snippet-id="dnssec-snippet">
    üîê DNSSEC Resolution ‚Äì Validating DNS records with chain of trust
  </div>
  <script type="text/plain" id="dnssec-snippet">
@startuml
title DNS Resolution Flow (DNSSEC-enabled)

actor User
participant Resolver as "DNS Resolver (Recursive)"
participant Root as "Root DNS (.) - ICANN"
participant TLD as "TLD DNS (.com - Registry Operator)"
participant Authoritative as "Authoritative DNS (e.g., Route 53 for example.com)"

User -> Resolver : Query "example.com" (with DNSSEC enabled)

' Step 1 - Ask Parent
Resolver -> TLD : Query DS for "example.com"
TLD --> Resolver : DS + RRSIG (signed by TLD key)

' Step 2 - Get DNSKEY from child zone
Resolver -> Authoritative : Query DNSKEY for "example.com"
Authoritative --> Resolver : DNSKEY + RRSIG (signed by zone key)

note over Resolver
Validate DNSKEY using DS from TLD.  
Root trust anchor ‚Üí TLD ‚Üí Authoritative zone.  
If mismatch ‚Üí reject response.
end note

' Step 3 - Query actual record
Resolver -> Authoritative : Query A for "example.com"
Authoritative --> Resolver : A record + RRSIG

note over Resolver
Verify A record using DNSKEY + RRSIG.  
If valid ‚Üí accept.  
If invalid ‚Üí discard.
end note

Resolver --> User : Return validated DNS record (IP for example.com)
@enduml
  </script>
</div>

<hr />

<h3 id="section-7-6-route-53-hosted-zone-resolution-flow">7.6 Route 53 Hosted Zone Resolution Flow</h3>

<ol>
  <li>You create a <strong>Hosted Zone</strong> in Route 53 for your domain (<code class="language-plaintext highlighter-rouge">example.com</code>).</li>
  <li>Route 53 assigns <strong>4 authoritative name servers (NS records)</strong> for the domain.</li>
  <li>You add DNS records (A, CNAME, MX, TXT, etc.) inside the hosted zone.</li>
  <li>When a client queries <code class="language-plaintext highlighter-rouge">example.com</code>, the DNS resolver follows the chain:
    <ul>
      <li>Root ‚Üí TLD ‚Üí <strong>Route 53 authoritative NS</strong> (Amazon-managed).</li>
    </ul>
  </li>
  <li>Route 53 authoritative servers return the DNS record (e.g., A record with an IP).</li>
  <li>Resolver caches and returns result to user ‚Üí user connects to the target resource.</li>
</ol>

<div class="image-wrapper">
  <img src="./assets/dns_resolution_flow.png" alt="DNS Resolution Flow" class="modal-trigger" data-caption="DNS resolution sequence flow (user to AWS Route 53)" />
  <div class="diagram-caption" data-snippet-id="dns-snippet">
    üåê DNS Resolution ‚Äì Query to Answer
  </div>
  <script type="text/plain" id="dns-snippet">
@startuml
title DNS Resolution Flow (Normal + DNSSEC)

actor User
participant Resolver as "DNS Resolver (Recursive)"
participant Root as "Root DNS (.)"
participant TLD as "TLD DNS (.com - Parent Zone)"
participant Authoritative as "Authoritative DNS (Route 53 for example.com)"

== Normal DNS Resolution ==
User -> Resolver : Query "example.com"

note right of Resolver : Step 1: Resolver receives query from User.

Resolver -> Root : Ask for NS of ".com"
Root --> Resolver : Referral: TLD servers for .com

note right of Resolver : Step 2: Resolver learns TLD servers.

Resolver -> TLD : Ask for NS of "example.com"
TLD --> Resolver : Referral: NS for "example.com" (Authoritative)

note right of Resolver : Step 3: Resolver learns authoritative NS.

Resolver -> Authoritative : Query DNS records (A, MX) for "example.com"
Authoritative --> Resolver : Return records (A, MX)

Resolver --> User : Return resolved records (e.g., A = 203.0.113.10)
User -> Authoritative : Connect using resolved IP
@enduml
  </script>
</div>

<hr />

<h2 id="section-8-vpn">8. VPN</h2>

<p>Note VPN builds on top of IPSec, for details on how IPSec works, see <a href="/study/infrastructureOsiModel#layer-3-56---ipsec">3.4 Layer 3 &amp; 5‚Äì6 - IPsec</a></p>

<h3 id="section-8-1-site-to-site-vpn">8.1 Site-to-Site VPN</h3>

<ul>
  <li><strong>Purpose</strong>:
    <ul>
      <li><strong>Site-to-Site VPN = Network ‚Üî Network</strong></li>
      <li>Connects an entire on-premises network (via a CGW) to an AWS VPC network (via a VGW or TGW).</li>
      <li>Used for <strong>hybrid cloud connectivity</strong>, extending datacenter or branch office networks into AWS.</li>
      <li><strong>Example</strong>: Your office LAN can securely reach EC2 instances inside VPCs.</li>
    </ul>
  </li>
</ul>

<div class="image-wrapper">
  <img src="./assets/s2s_vpn.png" alt="S2S VPN Example" class="modal-trigger" data-caption="Site-to-Site VPN sequence showing CGW and VGW communication flow" />
  <div class="diagram-caption" data-snippet-id="s2s-snippet">
    üîê Site-to-Site VPN ‚Äì Communication Sequence
  </div>
  <!-- Keep your PlantUML raw here -->
  <script type="text/plain" id="s2s-snippet">
@startuml
title Classic VPN Setup with AWS Network (CGW and VGW)

participant OnPrem as "On-Premises Network"
participant ISP as "Internet Service Provider"
participant Internet as "AWS Public Internet"
participant VPC as "VPC (AWS Private Network)"

' Classic VPN (VGW method)
OnPrem -> ISP : From CGW: Request VPN Tunnel (IPsec Initiation)
ISP -> Internet : Forwards Tunnel Request
Internet -> VPC : Forwards Request to VGW
VPC -> Internet : From VGW: Sends Tunnel Setup Acknowledgement
Internet -> ISP : Sends Acknowledgement
ISP -> OnPrem : Tunnel Setup Confirmation to CGW

alt High Availability
    OnPrem -> ISP : Switch to Backup Tunnel (Tunnel 2)
    ISP -> Internet : Forwards Traffic to Backup Tunnel
    Internet -> VPC : Routes Traffic to Backup Tunnel
end

OnPrem -> VPC : Routes Traffic to VPC
OnPrem -> VPC : Continuous keep-alive messages
VPC -> VPC : Acknowledges Keep-alive

' Floating note at the very bottom
note across
  If you replace VGW with TGW (Transit Gateway),  
  the VPN becomes a scalable solution that can connect to multiple VPCs.  
  This allows a central hub (TGW) to route traffic between various VPCs,  
  providing more flexibility and scalability in larger environments.
end note

@enduml
  </script>
</div>

<h4 id="section-8-1-1-connectivity-types">8.1.1 Connectivity Types</h4>

<p>Keep in mind, VPN connections traverse the public Internet before reaching AWS‚Äôs network. Because of this, the routing path and how routes are exchanged are critical.</p>

<ul>
  <li><strong>Static VPN</strong>
    <ul>
      <li><strong>Route</strong>: Static routes in route tables (manual setup).</li>
      <li><strong>Pros</strong>: Simple setup.</li>
      <li><strong>Cons</strong>: No load balancing or failover.</li>
    </ul>
  </li>
  <li><strong>Dynamic VPN</strong>
    <ul>
      <li><strong>Route</strong>: Uses <strong>BGP</strong> for automatic route exchange.</li>
      <li><strong>Pros</strong>: High availability, automatic failover, and load balancing.</li>
      <li><strong>Cons</strong>: More complex setup.</li>
    </ul>
  </li>
</ul>

    </article>
  </main>

  <div id="imageModal" class="image-modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <button class="modal-nav modal-prev">&#8249;</button>
    <button class="modal-nav modal-next">&#8250;</button>
    <img id="modalImage" src="" alt="">
    <div id="modalCaption"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const modal = document.getElementById('imageModal');
  const modalImg = document.getElementById('modalImage');
  const modalCaption = document.getElementById('modalCaption');
  const modalClose = document.querySelector('.modal-close');
  const modalPrev = document.querySelector('.modal-prev');
  const modalNext = document.querySelector('.modal-next');

  const SCALE_STEP = 0.2;
  const MIN_SCALE = 1;
  const MAX_SCALE = 3;

  let modalImages = [];
  let currentIndex = -1;
  let currentScale = MIN_SCALE;
  let translateX = 0;
  let translateY = 0;
  let isDragging = false;
  let isTouchDragging = false;
  let isPinching = false;
  let dragStartX = 0;
  let dragStartY = 0;
  let pinchStartDistance = 0;
  let pinchStartScale = MIN_SCALE;
  let transitionTimeout;

  function refreshModalImages() {
    modalImages = Array.from(document.querySelectorAll('.modal-trigger'));
  }

  function applyTransform(withTransition = false) {
    if (currentScale <= MIN_SCALE) {
      currentScale = MIN_SCALE;
      translateX = 0;
      translateY = 0;
    }

    if (transitionTimeout) {
      clearTimeout(transitionTimeout);
      transitionTimeout = null;
    }

    modalImg.style.transition = withTransition ? 'transform 0.15s ease' : 'none';
    modalImg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${currentScale})`;
    modalImg.style.cursor = currentScale > MIN_SCALE
      ? (isDragging || isTouchDragging ? 'grabbing' : 'grab')
      : 'auto';

    if (withTransition) {
      transitionTimeout = setTimeout(() => {
        modalImg.style.transition = 'none';
      }, 160);
    }
  }

  function resetTransform() {
    currentScale = MIN_SCALE;
    translateX = 0;
    translateY = 0;
    applyTransform(false);
  }

  function getDistance(touch1, touch2) {
    return Math.hypot(
      touch1.clientX - touch2.clientX,
      touch1.clientY - touch2.clientY
    );
  }

  function openModalAtIndex(index) {
    refreshModalImages();

    if (!modalImages.length) {
      return;
    }

    if (index < 0) {
      index = modalImages.length - 1;
    } else if (index >= modalImages.length) {
      index = 0;
    }

    const target = modalImages[index];
    if (!target) {
      return;
    }

    currentIndex = index;
    const src = target.dataset.modalSrc || target.src;
    const caption = target.getAttribute('data-caption') || target.alt;

    modalImg.src = src;
    modalCaption.textContent = caption || '';
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
    resetTransform();
  }

  function closeModal() {
    if (!modal.classList.contains('show')) {
      return;
    }
    modal.classList.remove('show');
    document.body.style.overflow = '';
    currentIndex = -1;
    isDragging = false;
    isTouchDragging = false;
    isPinching = false;
    resetTransform();
  }

  refreshModalImages();

  modalImg.addEventListener('dragstart', event => event.preventDefault());

  document.addEventListener('click', event => {
    const trigger = event.target.closest('.modal-trigger');
    if (!trigger) {
      return;
    }

    event.preventDefault();
    refreshModalImages();
    const index = modalImages.indexOf(trigger);
    openModalAtIndex(index > -1 ? index : 0);
  });

  modalClose?.addEventListener('click', closeModal);

  modal.addEventListener('click', event => {
    if (event.target === modal) {
      closeModal();
    }
  });

  document.addEventListener('keydown', event => {
    if (!modal.classList.contains('show')) {
      return;
    }

    switch (event.key) {
      case 'Escape':
        closeModal();
        break;
      case 'ArrowLeft':
        event.preventDefault();
        openModalAtIndex(currentIndex - 1);
        break;
      case 'ArrowRight':
        event.preventDefault();
        openModalAtIndex(currentIndex + 1);
        break;
      case '+':
      case '=':
        event.preventDefault();
        currentScale = Math.min(MAX_SCALE, currentScale + SCALE_STEP);
        applyTransform(true);
        break;
      case '-':
        event.preventDefault();
        currentScale = Math.max(MIN_SCALE, currentScale - SCALE_STEP);
        applyTransform(true);
        break;
      case '0':
        event.preventDefault();
        resetTransform();
        applyTransform(true);
        break;
      default:
        break;
    }
  });

  modal.addEventListener('wheel', event => {
    if (!modal.classList.contains('show')) {
      return;
    }

    event.preventDefault();
    const delta = event.deltaY > 0 ? -SCALE_STEP : SCALE_STEP;
    const nextScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, currentScale + delta));

    if (nextScale === currentScale) {
      return;
    }

    currentScale = nextScale;
    applyTransform(true);
  }, { passive: false });

  if (modalPrev) {
    modalPrev.addEventListener('click', event => {
      event.preventDefault();
      if (currentIndex === -1) {
        return;
      }
      openModalAtIndex(currentIndex - 1);
    });
  }

  if (modalNext) {
    modalNext.addEventListener('click', event => {
      event.preventDefault();
      if (currentIndex === -1) {
        return;
      }
      openModalAtIndex(currentIndex + 1);
    });
  }

  modalImg.addEventListener('mousedown', event => {
    if (!modal.classList.contains('show') || currentScale <= MIN_SCALE) {
      return;
    }

    event.preventDefault();
    isDragging = true;
    dragStartX = event.clientX;
    dragStartY = event.clientY;
    modalImg.style.cursor = 'grabbing';
  });

  document.addEventListener('mousemove', event => {
    if (!isDragging) {
      return;
    }

    event.preventDefault();
    translateX += event.clientX - dragStartX;
    translateY += event.clientY - dragStartY;
    dragStartX = event.clientX;
    dragStartY = event.clientY;
    applyTransform(false);
  });

  document.addEventListener('mouseup', () => {
    if (!isDragging) {
      return;
    }
    isDragging = false;
    modalImg.style.cursor = currentScale > MIN_SCALE ? 'grab' : 'auto';
  });

  modalImg.addEventListener('touchstart', event => {
    if (!modal.classList.contains('show')) {
      return;
    }

    if (event.touches.length === 1 && currentScale > MIN_SCALE) {
      event.preventDefault();
      isTouchDragging = true;
      dragStartX = event.touches[0].clientX;
      dragStartY = event.touches[0].clientY;
      modalImg.style.cursor = 'grabbing';
    } else if (event.touches.length === 2) {
      event.preventDefault();
      isTouchDragging = false;
      isPinching = true;
      pinchStartDistance = getDistance(event.touches[0], event.touches[1]);
      pinchStartScale = currentScale;
      modalImg.style.cursor = currentScale > MIN_SCALE ? 'grab' : 'auto';
    }
  }, { passive: false });

  modalImg.addEventListener('touchmove', event => {
    if (!modal.classList.contains('show')) {
      return;
    }

    if (isPinching && event.touches.length === 2) {
      event.preventDefault();
      const distance = getDistance(event.touches[0], event.touches[1]);
      if (pinchStartDistance > 0) {
        const scaleRatio = distance / pinchStartDistance;
        currentScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, pinchStartScale * scaleRatio));
        applyTransform(false);
      }
    } else if (isTouchDragging && event.touches.length === 1) {
      event.preventDefault();
      translateX += event.touches[0].clientX - dragStartX;
      translateY += event.touches[0].clientY - dragStartY;
      dragStartX = event.touches[0].clientX;
      dragStartY = event.touches[0].clientY;
      applyTransform(false);
    }
  }, { passive: false });

  modalImg.addEventListener('touchend', event => {
    if (!modal.classList.contains('show')) {
      return;
    }

    if (event.touches.length === 0) {
      isTouchDragging = false;
      modalImg.style.cursor = currentScale > MIN_SCALE ? 'grab' : 'auto';
    }

    if (event.touches.length < 2) {
      isPinching = false;
      pinchStartDistance = 0;
      pinchStartScale = currentScale;
    }
  });

  modalImg.addEventListener('touchcancel', () => {
    if (!modal.classList.contains('show')) {
      return;
    }

    isTouchDragging = false;
    isPinching = false;
    pinchStartDistance = 0;
    pinchStartScale = currentScale;
    modalImg.style.cursor = currentScale > MIN_SCALE ? 'grab' : 'auto';
  });

  modal.addEventListener('touchend', event => {
    if (!modal.classList.contains('show')) {
      return;
    }

    if (event.target === modal && event.changedTouches.length === 1 && !isTouchDragging && !isPinching) {
      closeModal();
    }
  }, { passive: true });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('[data-snippet-id]').forEach(caption => {
    const snippetId = caption.getAttribute('data-snippet-id');
    const snippetElement = document.getElementById(snippetId);

    if (snippetElement) {
      const content = snippetElement.textContent.replace(/"/g, '&quot;');
      caption.setAttribute('data-tooltip', content);
      caption.classList.add('diagram-caption');
    }
  });
});
</script>


  <!-- Floating Table of Contents -->
  <div id="floating-toc" class="floating-toc">
    <div class="toc-icon">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="8" y1="6" x2="21" y2="6"></line>
        <line x1="8" y1="12" x2="21" y2="12"></line>
        <line x1="8" y1="18" x2="21" y2="18"></line>
        <line x1="3" y1="6" x2="3.01" y2="6"></line>
        <line x1="3" y1="12" x2="3.01" y2="12"></line>
        <line x1="3" y1="18" x2="3.01" y2="18"></line>
      </svg>
    </div>
    <div class="toc-content">
      <div class="toc-header">
        <span>Contents</span>
        <button class="toc-close" aria-label="Close table of contents">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <nav class="toc-nav" id="toc-nav">
        <!-- Generated by JavaScript -->
      </nav>
    </div>
  </div>

  <footer class="site-footer">
    <span>¬© 2026 glucolte ‚Ä¢ </span>
    <a href="https://github.com/gLuColte/glucolte.github.io">source</a>
  </footer>

  <script>
    // Dark mode functionality
    function initDarkMode() {
      const toggle = document.getElementById('dark-mode-toggle');
      const body = document.body;
      
      // Check for saved theme preference or default to light mode
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      
      if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
        body.setAttribute('data-theme', 'dark');
      }
      
      // Toggle dark mode
      if (toggle) {
        toggle.addEventListener('click', function() {
          const currentTheme = body.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          
          body.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
        });
      }
    }
    
    // Initialize dark mode immediately to prevent flash
    initDarkMode();
    
    // Initialize highlight.js and floating TOC after the DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      hljs.highlightAll();
      
      // Floating TOC functionality - only show on sub-study pages
      const floatingToc = document.getElementById('floating-toc');
      const tocNav = document.getElementById('toc-nav');
      const tocClose = document.querySelector('.toc-close');
      
      // Check if we're on a sub-study page (not the main study index)
      const isSubStudyPage = window.location.pathname !== '/study/' && 
                            window.location.pathname !== '/study' && 
                            window.location.pathname.startsWith('/study/');
      
      if (floatingToc && tocNav && isSubStudyPage) {
        // Generate TOC from headings
        function generateTOC() {
          const headings = document.querySelectorAll('.content h1, .content h2, .content h3, .content h4, .content h5, .content h6');
          if (headings.length === 0) {
            floatingToc.style.display = 'none';
            return;
          }
          
          const tocList = document.createElement('ul');
          let currentLevel = 0;
          let currentList = tocList;
          const listStack = [tocList];
          
          headings.forEach((heading, index) => {
            const level = parseInt(heading.tagName.charAt(1));
            const id = heading.id || `heading-${index}`;
            
            // Ensure heading has an ID
            if (!heading.id) {
              heading.id = id;
            }
            
            // Create list item
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.href = `#${id}`;
            link.textContent = heading.textContent.trim();
            link.addEventListener('click', function(e) {
              e.preventDefault();
              const targetElement = document.getElementById(id);
              if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // Close TOC after clicking
                floatingToc.classList.remove('toc-open');
              }
            });
            
            listItem.appendChild(link);
            
            // Handle nesting
            if (level > currentLevel) {
              // Go deeper
              for (let i = currentLevel; i < level; i++) {
                const newList = document.createElement('ul');
                currentList.appendChild(newList);
                listStack.push(newList);
                currentList = newList;
              }
            } else if (level < currentLevel) {
              // Go shallower
              for (let i = currentLevel; i > level; i--) {
                listStack.pop();
                currentList = listStack[listStack.length - 1];
              }
            }
            
            currentList.appendChild(listItem);
            currentLevel = level;
          });
          
          tocNav.appendChild(tocList);
        }
        
        // Generate the TOC
        generateTOC();
        
        // Handle close button
        if (tocClose) {
          tocClose.addEventListener('click', function() {
            floatingToc.classList.remove('toc-open');
          });
        }
        
        // Handle click on icon to toggle
        const tocIcon = document.querySelector('.toc-icon');
        if (tocIcon) {
          tocIcon.addEventListener('click', function() {
            floatingToc.classList.toggle('toc-open');
          });
        }
        
        // Active section highlighting
        function updateActiveSection() {
          const headings = document.querySelectorAll('.content h1, .content h2, .content h3, .content h4, .content h5, .content h6');
          const tocLinks = tocNav.querySelectorAll('a');
          
          // Remove active class from all links
          tocLinks.forEach(link => link.classList.remove('active'));
          
          // Find the current section
          let currentHeading = null;
          const scrollPosition = window.scrollY + 100; // Offset for better UX
          
          for (let i = headings.length - 1; i >= 0; i--) {
            const heading = headings[i];
            const headingTop = heading.offsetTop;
            
            if (headingTop <= scrollPosition) {
              currentHeading = heading;
              break;
            }
          }
          
          // Add active class to current section
          if (currentHeading) {
            const activeLink = tocNav.querySelector(`a[href="#${currentHeading.id}"]`);
            if (activeLink) {
              activeLink.classList.add('active');
            }
          }
        }
        
        // Update active section on scroll
        let scrollTimeout;
        window.addEventListener('scroll', function() {
          if (scrollTimeout) {
            clearTimeout(scrollTimeout);
          }
          scrollTimeout = setTimeout(updateActiveSection, 10);
        });
        
        // Initial update
        updateActiveSection();
      } else if (floatingToc && !isSubStudyPage) {
        // Hide floating TOC on main study page
        floatingToc.style.display = 'none';
      }
      
      // Legacy TOC functionality (for existing markdown TOCs)
      const toc = document.querySelector('#markdown-toc');
      if (toc) {
        // Hide the floating TOC if there's already a markdown TOC
        if (floatingToc) {
          floatingToc.style.display = 'none';
        }
        
        // Create TOC container with header
        const tocContainer = document.createElement('div');
        tocContainer.className = 'toc-container';
        tocContainer.style.cssText = `
          background: #f8fafc;
          border: 1px solid #e5e7eb;
          border-radius: 8px;
          padding: 16px;
          margin: 20px 0;
          position: relative;
        `;
        
        // Add TOC header
        const tocHeader = document.createElement('h3');
        tocHeader.textContent = 'Table of Contents';
        tocHeader.style.cssText = `
          margin: 0 0 12px 0;
          font-size: 16px;
          font-weight: 600;
          color: #374151;
        `;
        
        // Add back to top button
        const backToTopBtn = document.createElement('button');
        backToTopBtn.textContent = '‚Üë Top';
        backToTopBtn.style.cssText = `
          position: absolute;
          top: 12px;
          right: 12px;
          background: #ffffff;
          border: 1px solid #d1d5db;
          border-radius: 6px;
          padding: 4px 8px;
          font-size: 12px;
          cursor: pointer;
          color: #6b7280;
          transition: all 0.2s ease;
        `;
        
        // Add hover effect for back to top button
        backToTopBtn.addEventListener('mouseenter', function() {
          this.style.background = '#f3f4f6';
          this.style.color = '#374151';
        });
        
        backToTopBtn.addEventListener('mouseleave', function() {
          this.style.background = '#ffffff';
          this.style.color = '#6b7280';
        });
        
        // Back to top functionality
        backToTopBtn.addEventListener('click', function() {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        // Style the TOC list
        toc.style.cssText = `
          margin: 0;
          padding: 0;
          font-size: 14px;
          line-height: 1.5;
        `;
        
        // Insert header and button into container
        tocContainer.appendChild(tocHeader);
        tocContainer.appendChild(backToTopBtn);
        tocContainer.appendChild(toc);
        
        // Replace the original TOC with the new container
        toc.parentNode.insertBefore(tocContainer, toc);
        tocContainer.appendChild(toc);
        
        // Add smooth scrolling to TOC links
        const tocLinks = toc.querySelectorAll('a');
        tocLinks.forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
              targetElement.scrollIntoView({ behavior: 'smooth' });
            }
          });
        });
      }
    });
  </script>
</body>
</html>
